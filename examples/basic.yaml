# Example spec file
# Usage:
#   With SSH agent: dist/platform-spec test ssh ubuntu@host examples/basic.yaml
#   With key file:  dist/platform-spec test ssh -i ~/.ssh/key.pem ubuntu@host examples/basic.yaml

version: "1.0"

metadata:
  name: "Basic System Test"
  description: "Tests basic system packages and files"
  tags: ["example", "basic"]

config:
  fail_fast: false
  parallel: false
  timeout: 300

tests:
  packages:
    - name: "Docker installed"
      packages:
        - docker-ce
      state: present
      version: 5:29.1.3-1~ubuntu.24.04~noble

  files:
    - name: "/opt directory exists"
      path: /opt
      type: directory
      mode: "755"

    - name: "/opt/monitoring/docker-compose.yml file exists"
      path: /opt/monitoring/docker-compose.yml
      type: file
      owner: neil
      group: neil

  services:
    - name: "Docker running"
      service: docker
      state: running
      enabled: true

  users:
    - name: "Neil user exists"
      user: neil
      shell: /bin/bash
      home: /home/neil

  groups:
    - name: "Docker group exists"
      groups:
        - docker
      state: present

  file_content:
    - name: "Docker compose file contains grafana keyword"
      path: /opt/monitoring/docker-compose.yml
      contains:
        - "grafana"

  command_content:
    - name: "Docker version check"
      command: docker --version
      contains:
        - "Docker version"

  docker:
    - name: "Grafana container running"
      container: grafana
      state: running
      restart_policy: unless-stopped

  filesystems:
    - name: "Root filesystem mounted"
      path: /
      state: mounted
      fstype: ext4

  ping:
    - name: "Internet connectivity"
      host: 8.8.8.8

  dns:
    - name: "External DNS resolution"
      host: google.com

  systeminfo:
    - name: "Ubuntu system validation"
      os: ubuntu
      os_version: "24.04"
      arch: "x86_64"
      kernel_version: "6.8.0"
      hostname: "srv01"
      version_match: prefix
